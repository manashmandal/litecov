<p align="center">
  <img src="logo.png" alt="LiteCov" width="200">
</p>

# LiteCov

Lightweight code coverage reporter for GitHub Actions. Zero infrastructure, one-line setup.

## Quick Start

```yaml
- uses: manashmandal/litecov@v1
```

That's it. LiteCov will auto-detect your coverage file and post a PR comment.

## Features

- **Zero infrastructure** - No server, database, or external services
- **Auto-detection** - Finds coverage files automatically
- **Multiple formats** - Supports LCOV and Cobertura XML
- **PR comments** - Posts coverage summary as a comment
- **Commit status** - Sets coverage status on commits
- **Configurable** - Filter files, set thresholds, customize output

## Usage

### Basic

```yaml
name: CI
on: [pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run tests with coverage
        run: go test -coverprofile=coverage.out ./...

      - name: Convert to LCOV
        run: |
          go install github.com/jandelgado/gcov2lcov@latest
          gcov2lcov -infile=coverage.out -outfile=coverage.lcov

      - uses: manashmandal/litecov@v1
```

### With Options

```yaml
- uses: manashmandal/litecov@v1
  with:
    coverage-file: coverage.lcov
    format: lcov
    show-files: changed
    threshold: 80
    title: Test Coverage
```

### Python Example

```yaml
- name: Run tests
  run: pytest --cov=src --cov-report=xml

- uses: manashmandal/litecov@v1
  with:
    coverage-file: coverage.xml
```

### JavaScript Example

```yaml
- name: Run tests
  run: npm test -- --coverage --coverageReporters=lcov

- uses: manashmandal/litecov@v1
  with:
    coverage-file: coverage/lcov.info
```

## Inputs

| Input | Default | Description |
|-------|---------|-------------|
| `coverage-file` | Auto-detect | Path to coverage report |
| `format` | `auto` | Format: `auto`, `lcov`, `cobertura` |
| `show-files` | `changed` | Files to show (see below) |
| `threshold` | `0` | Minimum coverage % to pass |
| `title` | `Coverage Report` | Comment header |
| `annotations` | `false` | Output GitHub annotations for uncovered lines |
| `token` | `GITHUB_TOKEN` | GitHub token |

### Show Files Options

- `changed` - Only files modified in the PR (default)
- `all` - All files in coverage report
- `threshold:N` - Files below N% coverage (e.g., `threshold:80`)
- `worst:N` - N files with lowest coverage (e.g., `worst:10`)

## Outputs

| Output | Description |
|--------|-------------|
| `coverage` | Coverage percentage |
| `lines-covered` | Covered lines count |
| `lines-total` | Total lines count |
| `files-count` | Number of files |

### Using Outputs

```yaml
- uses: manashmandal/litecov@v1
  id: coverage

- name: Check coverage
  run: |
    echo "Coverage: ${{ steps.coverage.outputs.coverage }}%"
    echo "Lines: ${{ steps.coverage.outputs.lines-covered }}/${{ steps.coverage.outputs.lines-total }}"
```

## PR Comment

LiteCov posts a clean, informative comment on your PR with clickable links:

```
## Coverage Report

| Metric | Value |
|--------|-------|
| **Coverage** | `82.50%` |
| **Lines** | `165/200` |
| **Files** | `12` |

| File | Coverage | Uncovered Lines |
|------|----------|----------------|
| `src/parser.go` | `91.20%` | L45-47, L102 |
| `src/utils.go` | `45.00%` :warning: | L12-15, L30-35, L50 +2 more |
```

- Files are hyperlinked to the GitHub blob view
- Uncovered lines are clickable and link to specific line ranges
- Files with coverage below 50% are marked with :warning:

## Supported Formats

### LCOV

Generated by:
- **JavaScript**: Jest, Vitest, c8, nyc
- **Go**: go test + gcov2lcov
- **Rust**: grcov, tarpaulin
- **C/C++**: gcov, llvm-cov
- **Ruby**: SimpleCov (with lcov formatter)

### Cobertura XML

Generated by:
- **Python**: pytest-cov, coverage.py
- **Java**: JaCoCo (with Cobertura export), Cobertura
- **.NET**: Coverlet

## Auto-Detection

LiteCov looks for coverage files in this order:
1. `coverage.lcov`
2. `lcov.info`
3. `coverage/lcov.info`
4. `coverage.xml`
5. `cobertura.xml`
6. `coverage/cobertura.xml`

## Threshold Enforcement

Set a minimum coverage threshold:

```yaml
- uses: manashmandal/litecov@v1
  with:
    threshold: 80
```

If coverage drops below 80%, the action will:
1. Set commit status to "failure"
2. Exit with code 1 (failing the workflow)

## License

MIT
